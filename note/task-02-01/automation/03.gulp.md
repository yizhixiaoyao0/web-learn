# Gulp

1. 基础使用

    ```
    yarn init --yes
    yarn add gulp --dev
    ```

    ```

    // gulp 的入口文件
    // 导出函数成员
    // 每个任务都为异步任务

    exports.foo = done => {
      console.log('foo');

      done();  // 表示任务完成
    }

    // 默认执行任务
    exports.default = done => {
      console.log('default task working');
      done();  // 表示任务完成
    }

    ```
2. 任务组合 (series, parallel)

    ```
    const { series, parallel }  = require('gulp');

    const task1 = done => {
      setTimeout(() => {
        console.log('task1 working');
        done();
      }, 1000)
    }


    const task2 = done => {
      setTimeout(() => {
        console.log('task1 working');
        done();
      }, 1000)
    }

    // 依次执行  例如： 部署
    exports.bar = series(task1, task2);

    // 并行执行
    exports.foz = parallel(task1, task2);
    ```

3. 异步任务

    * 回调函数

    * promise

    * 文件读取

    ```

    // 异步

    exports.callback = done => {
      console.log('done');
      done();
    }

    exports.callback_error = done => {
      console.log('done');
      done(new Error('task error'));
    }

    exports.promise = () => {
      console.log('promise task')
      return Promise.resolve();
    }

    exports.promise_error = () => {
      console.log('promise task')
      return Promise.reject(new Error('task error'));
    }

    const timeout = (time) => {
      return new Promise((resolve, reject) => {
        setTimeout(() => {
          resolve()
        }, time)
      })
    }

    exports.async = async () => {
      await timeout(1000);
    }

    const fs = require('fs');

    exports.stream = () => {
      const readStream = fs.createReadStream('package.json');
      const writeStream = fs.createWriteStream('temp.txt');
      readStream.pipe(writeStream);
      return readStream;
    }

    // gulp中注册了end事件，监听事件是否结束
    exports.stream = done => {
      const readStream = fs.createReadStream('package.json');
      const writeStream = fs.createWriteStream('temp.txt');
      readStream.pipe(writeStream);
      readStream.on('end', () => {
        done();
      })
    }
    ```
4. 构建过程 (核心工作原理)